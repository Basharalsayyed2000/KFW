<!-- employer.component.html -->
<div class="employer-page p-4">
  <div class="flex flex-col justify-center items-center">
    <h2 class="text-xl font-bold mb-4">Employer Page</h2>

    <button

      pButton
      label="Request Job"
      icon="pi pi-plus"
      class="p-button-raised p-button-primary mb-4 px-4 py-2"
      (click)="openDialog()"
    ></button>

    <!-- <button
      *ngIf="jobRequested"
      pButton
      label="Update Job Request"
      icon="pi pi-pencil"
      class="p-button-raised p-button-primary mb-4 px-4 py-2"
    ></button> -->
  </div>

  <!-- Dialog -->
  <p-dialog
    [(visible)]="displayDialog"
    header="Request Job"
    [modal]="true"
    [style]="{ width: '30vw' }"
  >
    <div>
      <h3 class="text-lg font-semibold mb-2">Step 1: Select Job Category</h3>
      <label for="category" class="block mb-2">Job Category:</label>
      <select
        id="category"
        [(ngModel)]="selectedCategory"
        (change)="onSelectCategory(selectedCategory)"
        class="w-full p-2 mt-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <option
          *ngFor="let category of mainCategories"
          [value]="category.value"
        >
          {{ category.label }}
        </option>
      </select>
    </div>

    <div *ngIf="selectedCategory" class="mt-4">
      <h3 class="text-lg font-semibold mb-2">Step 2: Enter Job Details</h3>
      <form (ngSubmit)="submitForm()">
        <!-- Number of Employees -->

        @if(subcategories.length > 0){
          <label
          for="subcategory"
          class="block text-sm font-medium text-gray-700 mb-1"
          >Job:</label
        >
        <p-multiSelect
          display="chip"
          [options]="subcategories"
          [(ngModel)]="jobDetails.job"
          name="job"
          [maxSelectedLabels]="3"
          styleClass="w-full md:w-80"
          placeholder="Select job(s)"
        ></p-multiSelect>
        }

        <!-- Job Title -->
        <label for="jobTitle" class="block mb-2">Job Title:</label>
        <input
          type="text"
          id="jobTitle"
          [(ngModel)]="jobDetails.title"
          name="jobTitle"
          placeholder="Enter job title"
          class="p-inputtext w-full mb-3"
          required
        />

        <label for="employees" class="block mb-2">Number of Employees:</label>
        <input
          type="number"
          id="employees"
          [(ngModel)]="jobDetails.numEmployees"
          name="employees"
          placeholder="Enter number of employees"
          class="p-inputtext w-full mb-3"
          required
        />

        <!-- Job Level -->
        <label for="level" class="block mb-2">Job Level:</label>
        <select
          id="level"
          [(ngModel)]="jobDetails.level"
          name="level"
          class="w-full p-2 mt-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <option value="junior">Junior</option>
          <option value="mid">Mid-Level</option>
          <option value="senior">Senior</option>
        </select>

        <!-- Location -->
        <label for="location" class="block mb-2">Location:</label>
        <input
          type="text"
          id="location"
          [(ngModel)]="jobDetails.location"
          name="location"
          placeholder="Enter job location"
          class="p-inputtext w-full mb-3"
          required
        />

        <!-- Type of Job -->
        <label for="typeOfJob" class="block mb-2">Type of Job:</label>
        <select
          id="typeOfJob"
          [(ngModel)]="jobDetails.typeOfJob"
          name="typeOfJob"
          class="w-full p-2 mt-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <option value="hybrid">Hybrid</option>
          <option value="onsite">Onsite</option>
          <option value="remote">Remote</option>
        </select>

        <!-- Supervisor Name -->
        <label for="supervisorName" class="block mb-2">Supervisor Name:</label>
        <input
          type="text"
          id="supervisorName"
          [(ngModel)]="jobDetails.supervisorName"
          name="supervisorName"
          placeholder="Enter supervisor name"
          class="p-inputtext w-full mb-3"
          required
        />

        <!-- Supervisor Position -->
        <label for="supervisorPosition" class="block mb-2"
          >Supervisor Position:</label
        >
        <input
          type="text"
          id="supervisorPosition"
          [(ngModel)]="jobDetails.supervisorPosition"
          name="supervisorPosition"
          placeholder="Enter supervisor position"
          class="p-inputtext w-full mb-3"
          required
        />

        <!-- Supervisor Email -->
        <label for="supervisorEmail" class="block mb-2"
          >Supervisor Email:</label
        >
        <input
          type="email"
          id="supervisorEmail"
          [(ngModel)]="jobDetails.supervisorEmail"
          name="supervisorEmail"
          placeholder="Enter supervisor email"
          class="p-inputtext w-full mb-3"
          required
        />

        <!-- Supervisor Phone Number -->
        <label for="supervisorPhone" class="block mb-2"
          >Supervisor Phone Number:</label
        >
        <input
          type="tel"
          id="supervisorPhone"
          [(ngModel)]="jobDetails.supervisorPhone"
          name="supervisorPhone"
          placeholder="Enter supervisor phone number"
          class="p-inputtext w-full mb-3"
          required
        />

        <div class="flex justify-end gap-2 mt-4">
          <button
            pButton
            label="Cancel"
            class="p-button-text p-button-danger px-4 py-2"
            (click)="closeDialog()"
            type="button"
          ></button>
          <button
            pButton
            label="Submit"
            icon="pi pi-check"
            class="p-button-raised p-button-success px-4 py-2"
          ></button>
        </div>
      </form>
    </div>
  </p-dialog>
</div>

  <h3 class="text-2xl font-bold text-[#1e90ff] dark:text-[#ffffff] mb-4 ml-7 shadow-sm">
    Job Requests
  </h3>
  <p-tabView (onTabChange)="onTabChange($event)">
  <!-- Waiting Tab -->
  <p-tabPanel header="Waiting" [headerStyleClass]="'waiting-tab'">
    <div class="overflow-x-auto">

<div class="max-w-5xl mx-auto my-8 p-6 bg-blue-50 rounded-lg shadow-lg">
    <!-- Table -->
    <div class="overflow-x-auto">
      <table class="min-w-full border-collapse bg-white rounded-lg shadow-md overflow-hidden">
        <thead>
          <tr class="bg-gray-200 text-left text-sm font-semibold text-gray-800">
            <th
              *ngFor="let column of columns"
              class="px-6 py-4 border-b border-gray-300 cursor-pointer hover:bg-gray-300"
              (click)="sortTable(column.key)"
            >
              <span class="flex items-center">
                {{ column.label }}
                <svg
                  class="w-4 h-4 ml-2"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path [attr.d]="getSortIconPath(column.key)" />
                </svg>
              </span>
            </th>
            <!-- Action Column -->
            <th class="px-6 py-4 border-b border-gray-300 text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let job of paginatedData"
            class="hover:bg-blue-100 transition-colors ease-in-out duration-150"
          >
          
            <td
              class="px-6 py-4 border-b border-gray-300 text-sm text-gray-700 font-semibold"
              *ngFor="let column of columns"
              
            >
              {{ job[column.key] }}
            </td>
            <!-- Action Buttons -->
            <td class="px-6 py-4 border-b border-gray-300 text-center">
              <div class="flex space-x-2 justify-center">

                
                <button
  class="bg-blue-500 text-white hover:bg-blue-600 focus:ring-2 focus:ring-blue-300 focus:outline-none rounded-full p-2 shadow-md transition-colors flex items-center"
  aria-label="Edit"
  (click)="openEditModal(job.id ?? 'N/A')"
>
  <i class="pi pi-pencil text-lg"></i>
</button>

  
                <button
                  class="bg-red-500 text-white hover:bg-red-600 focus:ring-2 focus:ring-red-300 focus:outline-none rounded-full p-2 shadow-md transition-colors flex items-center"
                  aria-label="Delete"
                  (click)="openDeleteModal(job)"
                >
                  <i class="pi pi-trash text-lg"></i>
                </button>
  
                <button
                  class="bg-green-500 text-white hover:bg-green-600 focus:ring-2 focus:ring-green-300 focus:outline-none rounded-full p-2 shadow-md transition-colors flex items-center"
                  aria-label="Info"
                  (click)="openModal(job.id ?? 'N/A')"
                >
                  <i class="pi pi-info text-lg"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  
  <!-- Pagination Controls -->
  <div class="mt-6 flex justify-between items-center">
    <!-- Previous Button -->
    <button
      class="px-6 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed"
      (click)="prevPage()"
      [disabled]="currentPage === 1"
    >
      Previous
    </button>

    <!-- Page Numbers -->
    <div class="flex items-center space-x-2">
      <span class="text-sm text-gray-600"
        >Page {{ currentPage }} of {{ totalPages }}</span
      >
    </div>

    <!-- Next Button -->
    <button
      class="px-6 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 disabled:bg-gray-200 disabled:cursor-not-allowed"
      (click)="nextPage()"
      [disabled]="currentPage === totalPages"
    >
      Next
    </button>
  </div>

  <!-- Search Input -->
  <div class="mt-4 flex items-center space-x-2">
    <input
      type="text"
      class="px-4 py-2 border border-gray-300 rounded-md"
      placeholder="Search"
      [(ngModel)]="searchQuery"
      (input)="searchJobs()"
    />
  </div>
</div>


<div
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
  *ngIf="isEditModalOpen"
>
  <div
    class="bg-white rounded-lg shadow-lg w-full max-w-6xl mx-4 p-6 relative h-[90%]"
  >
    <!-- Close Button -->
    <button
      class="absolute top-3 right-3 text-gray-600 hover:text-gray-800"
      (click)="closeEditModal()"
    >
      &times;
    </button>

    <!-- Edit Job Component -->
    <app-job-request
      [jobId]="selectedJobId"
      *ngIf="selectedJobId"
    ></app-job-request>

    <!-- Close Button for Modal -->
    <div class="flex justify-end mt-4">
      <button
        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300"
        (click)="closeEditModal()"
      >
        Close
      </button>
    </div>
  </div>
</div>

<div
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
  *ngIf="isModalOpen"
>
  <div
    class="bg-white rounded-lg shadow-lg w-full max-w-6xl mx-4 p-6 relative h-[90%]"
  >
    <button
      class="absolute top-3 right-3 text-gray-600 hover:text-gray-800"
      (click)="closeModal()"
    >
      &times;
    </button>

    <!-- Job Details Component -->
    <app-job-request-details [jobId]="selectedJobId" *ngIf="selectedJobId">
    </app-job-request-details>

    <!-- Close Button -->
    <div class="flex justify-end mt-4">
      <button
        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300"
        (click)="closeModal()"
      >
        Close
      </button>
    </div>
  </div>
</div>

<div
  id="delete-confirm-modal"
  tabindex="-1"
  class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"
  *ngIf="isDeleteModalOpen"
>
  <div class="relative p-4 w-full max-w-md max-h-full">
    <div
      class="relative bg-white border border-gray-400 rounded-lg shadow-lg dark:bg-gray-800 dark:border-gray-700"
    >
      <button
        type="button"
        class="absolute top-3 end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
        (click)="closeDeleteModal()"
      >
        <svg
          class="w-3 h-3"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 14 14"
        >
          <path
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
          />
        </svg>
        <span class="sr-only">Close modal</span>
      </button>
      <div class="p-4 md:p-5 text-center">
        <svg
          class="mx-auto mb-4 text-gray-400 w-12 h-12 dark:text-gray-200"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 20 20"
        >
          <path
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
          />
        </svg>
        <h3 class="mb-5 text-lg font-normal text-gray-500 dark:text-gray-400">
          Are you sure you want to delete <strong>{{ selectedJobTitle }}</strong
          >?
        </h3>
        <button
          type="button"
          class="text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:focus:ring-red-800 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center"
          (click)="confirmDelete()"
        >
          Yes, I'm sure
        </button>
        <button
          type="button"
          class="py-2.5 px-5 ms-3 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"
          (click)="closeDeleteModal()"
        >
          No, cancel
        </button>
      </div>
    </div>
  </div>
</div>
</div>


</p-tabPanel>
<p-tabPanel header="Assigned" [headerStyleClass]="'assigned-tab'">
  <p>Assigned jobs will go here.</p>
</p-tabPanel>
<p-tabPanel header="In Progress" [headerStyleClass]="'in-progress-tab'">
  <p>In-progress jobs will go here.</p>
</p-tabPanel>
<p-tabPanel header="Completed" [headerStyleClass]="'completed-tab'">
  <p>Completed jobs will go here.</p>
</p-tabPanel>
</p-tabView>